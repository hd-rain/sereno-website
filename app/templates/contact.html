{% extends "base.html" %}

{% block content %}
<section class="section section-bg-light">
    <div class="container">
        <div class="contact-hero">
            <h1>{{ page.title }}</h1>
            <p class="lead">{{ page.extra.description }}</p>
        </div>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="contact-content">
            <div class="contact-info">
                <h2>{{ page.extra.info_title }}</h2>
                <div class="contact-details">
                    <p>{{ page.extra.info_description }}</p>
                    <div class="contact-features">
                        <div class="contact-feature">
                            <h3>{{ page.extra.response_title }}</h3>
                            <p>{{ page.extra.response_description }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="contact-form-wrapper">
                <form class="contact-form" id="contact-form" method="POST" action="/api/contact">
                    <div class="form-group form-group--half">
                        <label for="prenom" class="form-label">{{ page.extra.form.prenom_label }} *</label>
                        <input type="text" id="prenom" name="prenom" class="form-input" pattern="[a-zA-Z\s\-]+"
                            title="Only letters, spaces, and hyphens are allowed" required>
                        <small class="form-hint">Only letters, spaces, and hyphens allowed</small>
                    </div>

                    <div class="form-group form-group--half">
                        <label for="nom" class="form-label">{{ page.extra.form.nom_label }} *</label>
                        <input type="text" id="nom" name="nom" class="form-input" pattern="[a-zA-Z\s\-]+"
                            title="Only letters, spaces, and hyphens are allowed" required>
                        <small class="form-hint">Only letters, spaces, and hyphens allowed</small>
                    </div>

                    <div class="form-group">
                        <label for="email" class="form-label">{{ page.extra.form.email_label }} *</label>
                        <input type="email" id="email" name="email" class="form-input" required>
                        <small class="form-hint">Only valid email address will be processed</small>
                    </div>

                    <div class="form-group">
                        <label for="phone" class="form-label">{{ page.extra.form.phone_label }} *</label>
                        <input type="tel" id="phone" name="phone" class="form-input" required>
                        <small class="form-hint">Only valid phone number will be processed</small>
                    </div>

                    <div class="form-group">
                        <label for="entreprise" class="form-label">{{ page.extra.form.company_label }} *</label>
                        <input type="text" id="entreprise" name="entreprise" class="form-input"
                            pattern="[a-zA-Z0-9\s\-]+" title="Only letters, numbers, spaces, and hyphens are allowed"
                            required>
                        <small class="form-hint">Only letters, numbers, spaces, and hyphens allowed</small>
                    </div>

                    <div class="form-group form-group--checkbox">
                        <input type="checkbox" id="newsletter" name="newsletter" class="form-checkbox">
                        <label for="newsletter" class="form-checkbox-label">
                            {{ page.extra.form.newsletter_label }}
                        </label>
                    </div>

                    <div class="form-group form-group--checkbox">
                        <input type="checkbox" id="privacy" name="privacy" class="form-checkbox" required>
                        <label for="privacy" class="form-checkbox-label">
                            {{ page.extra.form.privacy_label }}
                            <a href="{{ get_url(path='/privacy/') }}" target="_blank" class="privacy-link">{{
                                page.extra.form.privacy_link_text }}</a>
                        </label>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="cta cta--primary" id="submit-btn">
                            {{ page.extra.form.submit_label }}
                        </button>
                    </div>

                    <div class="form-message" id="form-message"></div>
                </form>
            </div>
        </div>
    </div>
</section>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@25.15.0/build/css/intlTelInput.css">
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@25.15.0/build/js/intlTelInput.min.js"></script>

<script>
    // Initialize phone input with combined options
    const phoneInput = document.querySelector("#phone");
    const iti = window.intlTelInput(phoneInput, {
        initialCountry: "gb",
        strictMode: true,
        separateDialCode: true,
        loadUtils: () => import("https://cdn.jsdelivr.net/npm/intl-tel-input@25.15.0/build/js/utils.js")
    });

    // Form validation and submission
    document.getElementById('contact-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const messageDiv = document.getElementById('form-message');
        const submitBtn = document.getElementById('submit-btn');

        // Add phone number in international format
        if (phoneInput.value.trim()) {
            formData.set('phone', iti.getNumber());
        }

        // Basic validation
        if (!iti.isValidNumber() && phoneInput.value.trim()) {
            messageDiv.innerHTML = '<p class="form-error">{{ page.extra.form.phone_error | default(value="Please enter a valid phone number") }}</p>';
            return;
        }

        submitBtn.textContent = '{{ page.extra.form.sending_label | default(value="Sending...") }}';
        submitBtn.disabled = true;

        // Here you would typically send to your backend API
        // For now, just show a placeholder message
        setTimeout(() => {
            messageDiv.innerHTML = '<p class="form-success">{{ page.extra.form.success_message | default(value="Thank you for your message. We will get back to you soon!") }}</p>';
            this.reset();
            iti.setNumber("");
            submitBtn.textContent = '{{ page.extra.form.submit_label }}';
            submitBtn.disabled = false;
        }, 1000);
    });
</script>
{% endblock content %}